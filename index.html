<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Симулятор трёх тел</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)']], displayMath: [['\\[','\\]']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>

  <div id="loader-wrapper">
    <div class="loader">
      <div class="inner one"></div>
      <div class="inner two"></div>
      <div class="inner three"></div>
    </div>
    <div class="loader">
      <div class="inner one"></div>
      <div class="inner two"></div>
      <div class="inner three"></div>
    </div>
  </div>

  <h1>Симулятор трёх тел</h1>
  <p id="ThreeBodyProblem-notSupportedMessage" class="ThreeBodyProblem-alert ThreeBodyProblem-isHiddenBlock">
    Пожалуйста, используйте современный браузер для просмотра симуляции.
  </p>
  <div class="ThreeBodyProblem-container isFullScreenWide isUnselectable">
    <div class="ThreeBodyProblem-sun">
      <img src="https://evgenii.com/image/blog/2018-09-27-three-body-problem-simulator/sun.png" class="ThreeBodyProblem-spin ThreeBodyProblem-bodyImage" alt="Солнце" />
    </div>
    <div class="ThreeBodyProblem-earth">
      <img src="https://evgenii.com/image/blog/2018-09-27-three-body-problem-simulator/earth.png" alt="Земля" class="ThreeBodyProblem-spin ThreeBodyProblem-bodyImage"/>
    </div>
    <div class="ThreeBodyProblem-jupiter">
      <img src="https://evgenii.com/image/blog/2018-09-27-three-body-problem-simulator/jupiter_juno.png" alt="Юпитер" class="ThreeBodyProblem-spin ThreeBodyProblem-bodyImage" />
    </div>
    <img src="https://evgenii.com/image/blog/2018-09-27-three-body-problem-simulator/center_of_mass.png" alt="Центр масс" class="ThreeBodyProblem-centerOfMass" />
    <canvas class="ThreeBodyProblem-canvas"></canvas>
    <div class="ThreeBodyProblem-hudContainer">
      <div class="ThreeBodyProblem-hudContainerChild">
      </div>
      
      <div class="ThreeBodyProblem-leftBottomButtonCantainer">
        <a class="ThreeBodyProblem-leftBottomButton ThreeBodyProblem-mass1Button ThreeBodyProblem-doesChangeOpacityOnHover" href="#" title="Масса 1">
          <img src="https://evgenii.com/image/blog/2018-09-27-three-body-problem-simulator/mass_one_icon.png" alt="Масса 1" class="ThreeBodyProblem-leftBottomImage">
        </a>
        <a class="ThreeBodyProblem-leftBottomButton ThreeBodyProblem-mass2Button ThreeBodyProblem-doesChangeOpacityOnHover" href="#" title="Масса 2">
          <img src="https://evgenii.com/image/blog/2018-09-27-three-body-problem-simulator/mass_two_icon.png" alt="Масса 2" class="ThreeBodyProblem-leftBottomImage">
        </a>
        <a class="ThreeBodyProblem-leftBottomButton ThreeBodyProblem-mass3Button ThreeBodyProblem-doesChangeOpacityOnHover" href="#" title="Масса 3">
          <img src="https://evgenii.com/image/blog/2018-09-27-three-body-problem-simulator/mass_three_icon.png" alt="Масса 3" class="ThreeBodyProblem-leftBottomImage">
        </a>
        <a class="ThreeBodyProblem-leftBottomButton ThreeBodyProblem-speedButton ThreeBodyProblem-doesChangeOpacityOnHover" href="#" title="Скорость">
          <img src="https://evgenii.com/image/blog/2018-09-27-three-body-problem-simulator/clock_icon.png" alt="Скорость" class="ThreeBodyProblem-leftBottomImage">
        </a>
        <a class="ThreeBodyProblem-leftBottomButton ThreeBodyProblem-softeningButton ThreeBodyProblem-doesChangeOpacityOnHover" href="#" title="Смягчение">
          <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMTguNSAxOC41YTYuNSA2LjUgMCAxIDAgMC0xMyIvPjxwYXRoIGQ9Ik01LjUgMTJoMTMiLz48L3N2Zz4=" alt="Смягчение" class="ThreeBodyProblem-leftBottomImage">
        </a>
        <a id="info-button" class="ThreeBodyProblem-leftBottomButton ThreeBodyProblem-doesChangeOpacityOnHover" href="#" title="Информация">
          <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTAiPjwvY2lyY2xlPjxsaW5lIHgxPSIxMiIgeTE9IjE2IiB4Mj0iMTIiIHkyPSIxMiI+PC9saW5lPjxsaW5lIHgxPSIxMiIgeTE9IjgiIHgyPSIxMi4wMSIgeTI9IjgiPjwvbGluZT48L3N2Zz4=" alt="Информация" class="ThreeBodyProblem-leftBottomImage">
        </a>
      </div>
      
      <div class="ThreeBodyProblem-rightBottomButtonContainer">
          <button class="ThreeBodyProblem-pause ThreeBodyProblem-button">Пауза</button>
          <a class="ThreeBodyProblem-reload ThreeBodyProblem-doesChangeOpacityOnHover" href="#" title="Перезапуск">
            <img src="https://evgenii.com/image/blog/2016-09-17-ridiculous-strawberry-picking/reload_icon.png" alt="Перезапуск" class="ThreeBodyProblem-reloadIcon">
          </a>
      </div>
    </div>
  </div>
  
  <div class="ThreeBodyProblem-controlsArea">
    <div class="ThreeBodyProblem-isTextCentered ThreeBodyProblem-hasTopMarginSmall ThreeBodyProblem-hasNegativeBottomMarginNormal isUnselectable">
      <span class="ThreeBodyProblem-sliderLabel">0.01</span>
    </div>
    <div class="SickSlider ThreeBodyProblem-slider isUnselectable">
      <div class="SickSlider-stripe"></div>
      <div class="SickSlider-head"></div>
    </div>
    <div class="ThreeBodyProblem-isTextCentered">
      <button class="ThreeBodyProblem-preset ThreeBodyProblem-button ThreeBodyProblem-button--isSelected" data-name="FigureEight">Восьмёрка</button>
      <button class="ThreeBodyProblem-preset ThreeBodyProblem-button" data-name="SunEarthJupiter">Солнце, Земля и Юпитер</button>
      <button class="ThreeBodyProblem-preset ThreeBodyProblem-button" data-name="LagrangePoint5">Точка Лагранжа L5</button>
      <button class="ThreeBodyProblem-preset ThreeBodyProblem-button" data-name="Kepler16">Кеплер-16</button>
      <button class="ThreeBodyProblem-preset ThreeBodyProblem-button" data-name="Chaotic">Хаотический</button>
    </div>
  </div>

  <div id="charts-container" style="max-width: 1100px; margin: 20px auto;">
    <details id="vel-details" style="margin-bottom: 10px;">
      <summary style="cursor:pointer; font-weight:600;">График скоростей (раскрыть/свернуть)</summary>
      <div style="width: 100%; height: 360px; margin-top: 10px;">
        <canvas id="velocityChart" style="width:100%; height:100%;"></canvas>
      </div>
    </details>
    <details id="eng-details">
      <summary style="cursor:pointer; font-weight:600;">График полной энергии (раскрыть/свернуть)</summary>
      <div style="width: 100%; height: 360px; margin-top: 10px;">
        <canvas id="energyChart" style="width:100%; height:100%;"></canvas>
      </div>
    </details>
  </div>

  <div id="info-modal" class="modal-overlay is-hidden">
    <div class="modal-content">
      <button class="modal-close-button" title="Закрыть">&times;</button>
      <div class="instruction-container">
        <h2 style="text-align: center; margin-bottom: 20px; font-family: 'Playfair Display', serif;">Инструкция по использованию симулятора трёх тел</h2>
        <div style="margin-bottom: 25px;">
          <h3 style="color: #6780FF;">Общее описание</h3>
          <p>Данный симулятор демонстрирует классическую задачу трёх тел в физике — проблему предсказания движения трёх массивных объектов, взаимодействующих гравитационно. В отличие от задачи двух тел, которая имеет аналитическое решение, задача трёх тел в общем случае не имеет точного решения и демонстрирует хаотическое поведение.</p>
        </div>
        <div style="margin-bottom: 25px;">
          <h3 style="color: #6780FF;">Режимы симуляции</h3>
          <ul style="list-style-type: none; padding-left: 10px;">
            <li style="margin-bottom: 12px;"><strong style="color: #ff8b22;">Восьмёрка</strong> — Особое периодическое решение задачи трёх тел, когда три объекта равной массы движутся по траектории в форме восьмёрки.</li>
            <li style="margin-bottom: 12px;"><strong style="color: #ff8b22;">Солнце, Земля и Юпитер</strong> — Упрощённая модель движения Солнца, Земли и Юпитера с сохранением приблизительных соотношений масс.</li>
            <li style="margin-bottom: 12px;"><strong style="color: #ff8б22;">Точка Лагранжа L5</strong> — Демонстрация точки равновесия L5 в системе из трёх тел.</li>
            <li style="margin-bottom: 12px;"><strong style="color: #ff8b22;">Кеплер-16</strong> — Симуляция, основанная на реальной звёздной системе Kepler-16, где планета вращается вокруг двух звёзд.</li>
            <li style="margin-bottom: 12px;"><strong style="color: #ff8b22;">Хаотический режим</strong> — Демонстрация хаотического движения трёх тел с равными массами, начинающими движение из равностороннего треугольника.</li>
          </ul>
        </div>
        <div style="margin-bottom: 25px;">
          <h3 style="color: #6780FF;">Управление симуляцией</h3>
          <p>В нижней части экрана симуляции расположены кнопки управления:</p>
          <ul style="list-style-type: none; padding-left: 10px;">
            <li style="margin-bottom: 12px;"><img src="https://evgenii.com/image/blog/2018-09-27-three-body-problem-simulator/mass_one_icon.png" alt="Масса 1" style="width: 20px; vertical-align: middle;"> — Настройка массы первого тела (красного в режиме «Восьмёрка»/«Хаос» или Солнца в других режимах).</li>
            <li style="margin-bottom: 12px;"><img src="https://evgenii.com/image/blog/2018-09-27-three-body-problem-simulator/mass_two_icon.png" alt="Масса 2" style="width: 20px; vertical-align: middle;"> — Настройка массы второго тела (синего в режиме «Восьмёрка»/«Хаос» или Земли в других режимах).</li>
            <li style="margin-bottom: 12px;"><img src="https://evgenii.com/image/blog/2018-09-27-three-body-problem-simulator/mass_three_icon.png" alt="Масса 3" style="width: 20px; vertical-align: middle;"> — Настройка массы третьего тела (зелёного в режиме «Восьмёрка»/«Хаос» или Юпитера в других режимах).</li>
            <li style="margin-bottom: 12px;"><img src="https://evgenii.com/image/blog/2018-09-27-three-body-problem-simulator/clock_icon.png" alt="Скорость" style="width: 20px; vertical-align: middle;"> — Регулировка скорости симуляции.</li>
            <li style="margin-bottom: 12px;"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" style="vertical-align: middle;" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18.5 18.5a6.5 6.5 0 1 0 0-13"/><path d="M5.5 12h13"/></svg> — Настройка параметра смягчения гравитации (epsilon), помогает избежать сингулярностей при близком прохождении тел.</li>
            <li style="margin-bottom: 12px;"><img src="https://evgenii.com/image/blog/2016-09-17-ridiculous-strawberry-picking/reload_icon.png" alt="Перезапуск" style="width: 20px; vertical-align: middle;"> — Перезапуск симуляции с текущими параметрами.</li>
          </ul>
        </div>
        <div style="margin-bottom: 25px;">
          <h3 style="color: #6780FF;">Как пользоваться слайдером</h3>
          <p>После нажатия на любую из кнопок управления активируется слайдер, расположенный в центре панели управления. Перемещая ползунок слайдера, вы изменяете выбранный параметр:</p>
          <p>Над слайдером отображается текущее значение выбранного параметра.</p>
        </div>
        <div style="margin-bottom: 25px;">
          <h3 style="color: #6780FF;">Физическая основа симуляции</h3>
          <p>Задача трёх тел — одна из фундаментальных проблем в классической механике и небесной механике. Она формулируется следующим образом: предсказать движение трёх тел, взаимодействующих только через гравитационные силы, зная их начальные положения, массы и скорости.</p>
          <p style="margin-top: 10px;">Основные физические принципы, используемые в симуляции:</p>
          <ul style="list-style-type: none; padding-left: 10px;">
            <li style="margin-bottom: 12px;">• <strong>Уравнение гравитационного взаимодействия:</strong> <span class='formula'>\(F = G \dfrac{m_1 m_2}{r^2}\)</span>, где F — сила притяжения, G — гравитационная постоянная, m₁ и m₂ — массы тел, r — расстояние между ними.</li>
            <li style="margin-bottom: 12px;">• <strong>Параметр смягчения гравитации (ε):</strong> Модифицирует закон Ньютона для избежания сингулярностей при очень сильных сближениях тел. Использованная формула: <span class='formula'>\(F = G \dfrac{m_1 m_2}{\left(r^2 + \varepsilon^2\right)^{3/2}}\)</span>.</li>
            <li style="margin-bottom: 12px;">• <strong>Второй закон Ньютона:</strong> <span class='formula'>\(F = m a\)</span>, где F — сила, m — масса, a — ускорение. В сочетании с законом гравитации это даёт систему дифференциальных уравнений.</li>
            <li style="margin-bottom: 12px;">• <strong>Метод Рунге—Кутты:</strong> Численный метод для решения обыкновенных дифференциальных уравнений. Метод 4-го порядка обеспечивает хороший баланс между точностью и эффективностью.</li>
          </ul>
        </div>
        <div style="margin-bottom: 25px;">
          <h3 style="color: #6780FF;">Теоретические аспекты</h3>
          <ul style="list-style-type: none; padding-left: 10px;">
            <li style="margin-bottom: 12px;">• <strong>Отсутствие аналитического решения:</strong> В отличие от задачи двух тел, которая имеет точное решение через эллиптические орбиты (законы Кеплера), задача трёх тел в общем случае не имеет аналитического решения.</li>
            <li style="margin-bottom: 12px;">• <strong>Хаотичность:</strong> Система трёх тел демонстрирует хаотическое поведение — небольшие изменения начальных условий могут привести к радикально различающимся траекториям со временем (эффект «бабочки»).</li>
            <li style="margin-bottom: 12px;">• <strong>Особые решения:</strong> Существуют некоторые особые случаи, когда движение трёх тел является периодическим или квази-периодическим. «Восьмёрка» — один из таких случаев, открытый относительно недавно (в 1993 году Муром, а в 2000 году Шенсине и Монтгомери дали строгое доказательство).</li>
            <li style="margin-bottom: 12px;">• <strong>Точки Лагранжа:</strong> Особые точки в системе трёх тел, где малое тело может оставаться относительно неподвижным по отношению к двум более массивным телам. L5 — одна из этих точек, где силы гравитации уравновешиваются.</li>
          </ul>
        </div>
        <div style="margin-bottom: 25px;">
          <h3 style="color: #6780FF;">Астрофизические примеры</h3>
          <ul style="list-style-type: none; padding-left: 10px;">
            <li style="margin-bottom: 12px;">• <strong>Солнце — Земля — Луна:</strong> Классический пример системы трёх тел в нашей Солнечной системе.</li>
            <li style="margin-bottom: 12px;">• <strong>Солнце — Юпитер — астероиды:</strong> Астероиды в точках Лагранжа L4 и L5 Юпитера («троянцы» и «греки») демонстрируют стабильность в трёхтельной системе.</li>
            <li style="margin-bottom: 12px;">• <strong>Системы с экзопланетами:</strong> Kepler-16 — реальная двойная звёздная система с планетой, вращающейся вокруг обеих звёзд.</li>
            <li style="margin-bottom: 12px;">• <strong>Тройные звезды:</strong> Такие системы, как Альфа Центавра (состоящая из трёх звёзд), представляют собой естественные примеры задачи трёх тел.</li>
          </ul>
        </div>
        <div style="margin-bottom: 25px;">
          <h3 style="color: #6780FF;">Исторический контекст</h3>
          <ul style="list-style-type: none; padding-left: 10px;">
            <li style="margin-bottom: 12px;">• <strong>Работы Ньютона:</strong> Сам Исаак Ньютон занимался задачей трёх тел, но не смог найти общее решение.</li>
            <li style="margin-bottom: 12px;">• <strong>Теорема Брунса—Пуанкаре:</strong> В 1887 году было доказано, что не существует общего аналитического решения задачи трёх тел в терминах алгебраических формул и интегралов.</li>
            <li style="margin-bottom: 12px;">• <strong>Ограниченная задача трёх тел:</strong> Эйлер и Лагранж нашли некоторые частные решения для случая, когда масса третьего тела пренебрежимо мала.</li>
            <li style="margin-bottom: 12px;">• <strong>Современные исследования:</strong> С развитием компьютерного моделирования были открыты новые типы орбит и решений, включая конфигурацию «восьмёрка», показанную в этой симуляции.</li>
          </ul>
        </div>
        <div style="margin-bottom: 25px;">
          <h3 style="color: #6780FF;">Отладочная консоль</h3>
          <p>Для более глубокого анализа работы симуляции вы можете использовать консоль разработчика браузера (DevTools):</p>
          <ul style="list-style-type: none; padding-left: 10px;">
            <li style="margin-bottom: 12px;">• <strong>Открытие консоли:</strong> Нажмите F12 или Ctrl+Shift+I (Cmd+Option+I на Mac), чтобы открыть инструменты разработчика, затем перейдите на вкладку «Консоль».</li>
            <li style="margin-bottom: 12px;">• <strong>Отладочная информация:</strong> Каждые 500 мс симулятор выводит подробные данные о текущем состоянии системы, включая:
              <ul style="padding-left: 20px; margin-top: 5px;">
                <li>Текущее время</li>
                <li>Название активного пресета</li>
                <li>Временной масштаб</li>
                <li>Координаты и скорости каждого тела</li>
                <li>Массы тел</li>
              </ul>
            </li>
            <li style="margin-bottom: 12px;">• <strong>Расширенный анализ:</strong> Вы можете использовать консоль для наблюдения за параметрами симуляции в реальном времени и отслеживания изменений в системе при модификации параметров.</li>
            <li style="margin-bottom: 12px;">• <strong>Взаимодействие с симуляцией:</strong> Продвинутые пользователи могут использовать консоль для программного изменения параметров симуляции с помощью JavaScript, обращаясь к глобальным объектам <code>physics</code> и <code>simulation</code>.</li>
          </ul>
        </div>
        <p style="font-style: italic; text-align: center; margin-top: 20px;">Задача трёх тел остаётся одной из классических нерешённых проблем физики и демонстрирует, как даже простые системы могут порождать сложное и непредсказуемое поведение.</p>
      </div>
    </div>
  </div>

  <p class="ThreeBodyProblem-debugOutput"></p>

  <script src="script.js"></script>
  <script src="physics.js"></script>
  <script src="graphics.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="simulation.js"></script>
  <script src="ui.js"></script>

  <script>
    (function() {
      window.chartManager = {};
      const MAX_POINTS = 2000;
      let chartsInited = false;
      let velocityChart = null;
      let energyChart = null;
      let frameIndex = 0;
      function trimData(chart) {
        const d = chart.data;
        while (d.labels.length > MAX_POINTS) {
          d.labels.shift();
          chart.data.datasets.forEach(ds => ds.data.shift());
        }
      }
      function resetCharts() {
        if (!chartsInited) return;
        frameIndex = 0;
        velocityChart.data.labels = [];
        velocityChart.data.datasets.forEach(dataset => { dataset.data = []; });
        velocityChart.update('none');
        energyChart.data.labels = [];
        energyChart.data.datasets.forEach(dataset => { dataset.data = []; });
        energyChart.update('none');
      }
      window.chartManager.reset = resetCharts;
      function initCharts() {
        if (chartsInited) return;
        const velCanvas = document.getElementById('velocityChart');
        const engCanvas = document.getElementById('energyChart');
        if (!velCanvas || !engCanvas || !window.Chart) return;
        const velCtx = velCanvas.getContext('2d');
        const engCtx = engCanvas.getContext('2d');
        velocityChart = new Chart(velCtx, {
          type: 'line',
          data: {
            labels: [],
            datasets: [
              { label: 'Скорость тела 1', data: [], borderColor: '#ff8b22', pointRadius: 0, tension: 0.1 },
              { label: 'Скорость тела 2', data: [], borderColor: '#6c81ff', pointRadius: 0, tension: 0.1 },
              { label: 'Скорость тела 3', data: [], borderColor: '#4ccd7a', pointRadius: 0, tension: 0.1 }
            ]
          },
          options: {
            responsive: true, maintainAspectRatio: false, animation: false,
            interaction: { mode: 'nearest', intersect: false },
            plugins: { legend: { display: true }, tooltip: { enabled: true } },
            scales: {
              x: { title: { display: true, text: 'Шаг симуляции' }, ticks: { maxTicksLimit: 8 } },
              y: { title: { display: true, text: 'Скорость (|v|)' }, ticks: { maxTicksLimit: 8 } }
            }
          }
        });
        energyChart = new Chart(engCtx, {
          type: 'line',
          data: {
            labels: [],
            datasets: [
              { label: 'Полная энергия', data: [], borderColor: '#ff4c4c', pointRadius: 0, tension: 0.1 }
            ]
          },
          options: {
            responsive: true, maintainAspectRatio: false, animation: false,
            interaction: { mode: 'nearest', intersect: false },
            plugins: { legend: { display: true }, tooltip: { enabled: true } },
            scales: {
              x: { title: { display: true, text: 'Шаг симуляции' }, ticks: { maxTicksLimit: 8 } },
              y: { title: { display: true, text: 'Энергия (K+U)' }, ticks: { maxTicksLimit: 8 } }
            }
          }
        });
        chartsInited = true;
        document.getElementById('vel-details')?.addEventListener('toggle', () => setTimeout(() => velocityChart?.resize(), 0));
        document.getElementById('eng-details')?.addEventListener('toggle', () => setTimeout(() => energyChart?.resize(), 0));
        window.addEventListener('resize', () => {
          velocityChart?.resize();
          energyChart?.resize();
        });
      }
      function updateCharts() {
        if (window.simulation && typeof simulation.isPaused === 'function' && simulation.isPaused()) {
          requestAnimationFrame(updateCharts);
          return;
        }
        if (window.physics && typeof physics.getSpeeds === 'function' && typeof physics.getTotalEnergy === 'function') {
          if (!chartsInited) initCharts();
          if (chartsInited) {
            const speeds = physics.getSpeeds();
            const energy = physics.getTotalEnergy();
            frameIndex += 1;
            const label = String(frameIndex);
            velocityChart.data.labels.push(label);
            for (let i = 0; i < 3; i++) {
              velocityChart.data.datasets[i].data.push(speeds[i] ?? null);
            }
            trimData(velocityChart);
            velocityChart.update('none');
            energyChart.data.labels.push(label);
            energyChart.data.datasets[0].data.push(energy);
            trimData(energyChart);
            energyChart.update('none');
          }
        }
        requestAnimationFrame(updateCharts);
      }
      window.addEventListener('load', () => {
        initCharts();
        requestAnimationFrame(updateCharts);
      });
    })();
  </script>

</body>
</html>
